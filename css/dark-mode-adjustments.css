:root {
    /*  Adjust background color to prevent pixels from turning off (contrary to popular belief, pixels turning off saves trivial energy, like <1% in measurements, and causes nasty scrolling/update jank due to delay in pixels turning back on), and improve contrast with the white.
     */
    --GW-body-background-color: #161616;

    /*  Dial back from pure white to keep contrast from being *too* high & 'stark' (#fff bg / #000 text seems to work in light mode, but not in dark mode, perhaps because of differences in lighting environment?)
     */
    --GW-body-text-color: #f1f1f1;

    /*  Adjust this one color in the syntax highlighting color scheme to make it
        less saturated. (The automatic inversion algorithm doesn‚Äôt quite handle
        it in the way we want.)
     */
    --GW-syntax-highlight-color-control-flow: #cce1c8;

    /*  Variable for SVGs to use (like for the ‚Äîùîä‚Äî footers on the index page)
     */
    --GW-body-background-color-inverted: #e9e9e9;

    /*  Reader mode.
     */
    --GW-reader-mode-masked-links-key-toggle-info-alert-panel-background-color: rgba(255, 255, 255, 0.85);

	/*	Wikipedia math images assume a white background; transparent images
		don‚Äôt look right if that assumption is violated.

		NOTE: This color value is --GW-body-background-color with the CSS
		`invert(1)` filter applied. If you modify --GW-body-background-color,
		modify this also!
	 */
	--GW-wikipedia-math-image-background-color: #e9e9e9;

	/*	Wikipedia images in figures likewise assume a white background, but
		might be transparent (and don‚Äôt get inverted).
	 */
	--GW-wikipedia-image-background-color: #fff;

	/*	Similar to the above, but for all SVGs, which don‚Äôt get inverted.
	 */
	--GW-transparent-svg-background-color: #fff;

    --GW-popups-popup-title-bar-pattern: var(--GW-image-pattern-dotted-161616-on-252525-2x-gif);
    --GW-popups-popup-title-bar-pattern-focused: var(--GW-image-pattern-dotted-161616-on-3e3e3e-2x-gif);

	--GW-popins-popin-backdrop-color: rgba(0, 0, 0, 0.6);

	--GW-popins-popin-title-bar-button-color: #bbb;

    --GW-dotted-underline-background-image: var(--GW-image-linear-dotted-fff-transparent-2x-gif);
    --GW-dotted-underline-hover-background-image: var(--GW-image-linear-dotted-bbb-transparent-2x-gif);
    --GW-dotted-underline-inverted-background-image: var(--GW-image-linear-dotted-000-transparent-2x-gif);
    --GW-dotted-underline-inverted-hover-background-image: var(--GW-image-linear-dotted-888-transparent-2x-gif);

	--GW-checkerboard-scrollbar-background-image: var(--GW-image-checkerboard-888-000-2x-gif);
	--GW-checkerboard-scrollbar-hover-background-image: var(--GW-image-checkerboard-bfbfbf-000-2x-gif);
}

/*	Some SVGs used in annotations/essays 
	(eg. /doc/genetics/selection/artificial//2023-meyer-figure1-moralacceptabilityandpersonalwillingnesstouseembryoselectionorgeneticeditinginausapopulationsurvey.svg ) 
	were authored as transparent SVGs, assuming a *white* background. In dark 
	mode, with a black background set, they are illegible.

	So, in dark mode only, impose a white background on SVGs in <figure>s. 
	(This is scoped narrowly to only apply to SVGs which are displayed in 
	<figure>, and not SVGs elsewhere‚Äîbecause SVGs elsewhere are probably part 
	of the site design, and will have been designed to work with dark mode; 
	forcing a white background on them may have unpredictable bad effects. If 
	it turns out that this is still too broad, we may have to instead manually 
	edit SVGs to force a white background, or selectively whitelist them for a 
	white background.)
 */
figure img[src$=".svg"]:not(.invert):not(.invert-auto) {
	background-color: var(--GW-transparent-svg-background-color);
}

/*	Audio elements don‚Äôt change color in dark mode, so their hover styles need
	adjusted.
 */
.markdownBody figure audio:hover {
    border-color: var(--GW-figure-outline-color);
    box-shadow:
        0 0 4px 0 currentColor inset,
        0 0 4px 0 currentColor;
}
/*  Special styles for special browsers.
	*/
@supports (-moz-appearance: none) {
	.markdownBody figure audio {
	    border-color: var(--GW-figure-outline-color);
	}
}

/*	Create a ‚Äòfooter‚Äô at the bottom of pages which looks like ‚Äò‚Äî‚Äî‚Äî‚Äî‚Äîùîä‚Äî‚Äî‚Äî‚Äî‚Äî‚Äô,
	similar to the arabesque navbar.

	Footers help denote ‚Äúthis is the end‚Äù, and avoid the somewhat lame effect of
	just having the anonymous feedback link at the end of the page and ending
	there with nothing else.

	Implementation: Modifying the ‚Äòfill‚Äô does not work so well when we call an
	SVG as a ‚Äòbackground-image‚Äô (like for the  footers on the index page), so we
	do variable+invert tricks to get a white copy of the logo as a hack.
 */
#footer-decoration-container a.footer-logo::after {
	filter: invert(1);
	background-color: var(--GW-body-background-color-inverted);
}

/*  The ‚Äòcelestial symbol‚Äô horizontal rules are SVGs and must be inverted.
 */
hr::after,
.horizontal-rule-nth-0 hr::after {
    opacity: 1;
    filter: invert(1) drop-shadow(0 0 0 currentColor);
}
.horizontal-rule-nth-1 hr::after {
    opacity: 0.75;
    filter: invert(1);
}
.horizontal-rule-nth-2 hr::after {
    opacity: 0.85;
    filter: invert(1);
}

/*  Admonition icons.
 */
div.admonition.tip::before {
    filter: invert(1);
}
div.admonition.note::before {
    filter: none;
}
div.admonition.warning::before {
    filter: none;
}
div.admonition.error::before {
    filter: none;
}

/*	SVG icons in the two darker styles of admonitions.
 */
div.admonition.warning a[data-link-icon-type='svg'] .link-icon-hook::after,
div.admonition.error a[data-link-icon-type='svg'] .link-icon-hook::after {
    filter: none;
}

/*  List bullets are SVGs and have to be inverted.
 */
ul > li::before {
    filter: invert(1);
}

/*  Exclusion for TOC entries.
 */
.TOC ul > li::before {
    filter: none;
}

/*  For sortable table column headings, we use dark versions of the up/down/both
    arrow icons.
 */
table th.tablesorter-header {
    background-image: url('/static/img/tablesorter/tablesorter-bg-dark.gif');
}
table th.tablesorter-headerAsc {
    background-image: url('/static/img/tablesorter/tablesorter-asc-dark.gif');
}
table th.tablesorter-headerDesc {
    background-image: url('/static/img/tablesorter/tablesorter-desc-dark.gif');
}

/*  Images that are marked as '.invert' by the server are inverted,
    hue-rotated, and desaturated. Other (non-invertible) images are merely
    desaturated. Hovering over an image restores it to its original state.
    Hierarchy: ‚Äò.invert-not‚Äô: no inversion or grayscale;
    ‚Äò.invert‚Äô/‚Äò.invert-auto‚Äô: inverted (uninverted upon mouse hover);
    none: grayscaled (ungrayscaled on hover).
 */
img.invert,
img.invert-auto {
    filter: grayscale(50%) invert(100%) brightness(95%) hue-rotate(180deg);
}
img:not(.invert):not(.invert-auto) {
    filter: grayscale(50%);
}
img,
img.invert,
img.invert-auto {
    transition: filter 0.25s ease;
}
img:hover,
img.invert:hover,
img.invert-auto:hover,
img:not(.invert):not(.invert-auto):hover {
    filter: none;
    transition: filter 0s ease 0.25s;
}

img[src$=".svg"].invert,
img[src$=".svg"].invert-auto {
	background-color: transparent;
}
img[src$=".svg"].invert:hover,
img[src$=".svg"].invert-auto:hover {
    filter: grayscale(50%) invert(100%) brightness(95%) hue-rotate(180deg);
}

/*	Image alt-text.
 */
img.invert::before,
img.invert-auto::before {
	filter: invert(1);
}
img.invert:hover::before,
img.invert-auto:hover::before {
	filter: none;
}
/*	Styling the image alt-text interferes with the transitions in dark mode.
	(We include non-class‚Äôd `img` in this selector for consistency.)

	TEMPORARY until we transition to a color-based instead of filter-based
	scheme for this. ‚ÄîSA 2022-07-29
 */
img,
img:hover,
img.invert,
img.invert:hover,
img.invert-auto,
img.invert-auto:hover {
	transition: none;
}

/*  For images which have been manually marked up with ‚Äò.invert-not‚Äô, we
    avoid any filtering at all. If they are manually marked up (artwork,
    diagrams with multiple subtly-different colors matched to a legend/caption),
    the color is important and shouldn‚Äôt be faded out by default.
 */
#markdownBody img.invert-not {
	filter: none;
}

/*  The loading spinner for object popups (image, iframe, object) is inverted
    and made more visible in dark mode.
 */
.popframe.loading::before {
    filter: invert(1);
    opacity: 0.4;
}

/*  ‚ÄúLoading failed‚Äù messages for object popups.
 */
.popframe.loading-failed::after {
    opacity: 0.4;
}

/*	Include-link loading spinner.
 */
a.include-loading.include-spinner::after {
	filter: invert(1);
}

/*  Masked links key toggle info alert panel.
 */
div#masked-links-key-toggle-info-alert img {
    filter: drop-shadow(0 0 3px var(--GW-reader-mode-masked-links-key-toggle-info-alert-panel-text-shadow-color));
}

/*  All SVG linkicons have to be inverted.
 */
a[data-link-icon-type*='svg'] .link-icon-hook::after {
    filter: invert(1);
}

/*	Recently-modified link icon.
 */
.has-recently-modified-icon .recently-modified-icon-hook::before,
.icon-single-white-star-on-black-circle::before {
	filter: invert(1);
}

/*	Math in Wikipedia pop-frames.
 */
.annotation.wikipedia-entry .wikipedia-math-block-wrapper img,
.annotation.wikipedia-entry .wikipedia-math-inline-wrapper img {
	filter: invert(1);
	background-color: var(--GW-wikipedia-math-image-background-color);
}

/*	Images in figures in Wikipedia pop-frames.
 */
.annotation.wikipedia-entry figure img {
	background-color: var(--GW-wikipedia-image-background-color);
}
